<script>
import { Line } from "vue-chartjs";

/* RGB Colors, Name */
const colors = [
  [[12, 9, 10], "Night"],
  [[44, 53, 57], "Gunmetal"],
  [[43, 27, 23], "Midnight"],
  [[52, 40, 44], "Charcoal"],
  [[37, 56, 60], "Dark Slate Grey"],
  [[59, 49, 49], "Oil"],
  [[65, 56, 57], "Black Cat"],
  [[61, 60, 58], "Iridium"],
  [[70, 62, 63], "Black Eel"],
  [[76, 70, 70], "Black Cow"],
  [[80, 74, 75], "Gray Wolf"],
  [[86, 80, 81], "Vampire Gray"],
  [[92, 88, 88], "Gray Dolphin"],
  [[98, 93, 93], "Carbon Gray"],
  [[102, 99, 98], "Ash Gray"],
  [[109, 105, 104], "Cloudy Gray"],
  [[114, 110, 109], "Smokey Gray"],
  [[115, 111, 110], "Gray"],
  [[131, 126, 124], "Granite"],
  [[132, 132, 130], "Battleship Gray"],
  [[182, 182, 180], "Gray Cloud"],
  [[209, 208, 206], "Gray Goose"],
  [[229, 228, 226], "Platinum"],
  [[188, 198, 204], "Metallic Silver"],
  [[152, 175, 199], "Blue Gray"],
  [[109, 123, 141], "Light Slate Gray"],
  [[101, 115, 131], "Slate Gray"],
  [[97, 109, 126], "Jet Gray"],
  [[100, 109, 126], "Mist Blue"],
  [[86, 109, 126], "Marble Blue"],
  [[115, 124, 161], "Slate Blue"],
  [[72, 99, 160], "Steel Blue"],
  [[43, 84, 126], "Blue Jay"],
  [[43, 56, 86], "Dark Slate Blue"],
  [[21, 27, 84], "Midnight Blue"],
  [[0, 0, 128], "Navy Blue"],
  [[52, 45, 126], "Blue Whale"],
  [[21, 49, 126], "Lapis Blue"],
  [[21, 27, 141], "Denim Dark Blue"],
  [[0, 0, 160], "Earth Blue"],
  [[0, 32, 194], "Cobalt Blue"],
  [[0, 65, 194], "Blueberry Blue"],
  [[37, 84, 199], "Sapphire Blue"],
  [[21, 105, 199], "Blue Eyes"],
  [[43, 96, 222], "Royal Blue"],
  [[31, 69, 252], "Blue Orchid"],
  [[105, 96, 236], "Blue Lotus"],
  [[115, 106, 255], "Light Slate Blue"],
  [[53, 126, 199], "Windows Blue"],
  [[54, 139, 193], "Glacial Blue Ice"],
  [[72, 138, 199], "Silk Blue"],
  [[48, 144, 199], "Blue Ivy"],
  [[101, 158, 199], "Blue Koi"],
  [[135, 175, 199], "Columbia Blue"],
  [[149, 185, 199], "Baby Blue"],
  [[114, 143, 206], "Light Steel Blue"],
  [[43, 101, 236], "Ocean Blue"],
  [[48, 110, 255], "Blue Ribbon"],
  [[21, 125, 236], "Blue Dress"],
  [[21, 137, 255], "Dodger Blue"],
  [[100, 149, 237], "Cornflower Blue"],
  [[102, 152, 255], "Sky Blue"],
  [[56, 172, 236], "Butterfly Blue"],
  [[86, 165, 236], "Iceberg"],
  [[92, 179, 255], "Crystal Blue"],
  [[59, 185, 255], "Deep Sky Blue"],
  [[121, 186, 236], "Denim Blue"],
  [[130, 202, 250], "Light Sky Blue"],
  [[130, 202, 255], "Day Sky Blue"],
  [[160, 207, 236], "Jeans Blue"],
  [[183, 206, 236], "Blue Angel"],
  [[180, 207, 236], "Pastel Blue"],
  [[194, 223, 255], "Sea Blue"],
  [[198, 222, 255], "Powder Blue"],
  [[175, 220, 236], "Coral Blue"],
  [[173, 223, 255], "Light Blue"],
  [[189, 237, 255], "Robin Egg Blue"],
  [[207, 236, 236], "Pale Blue Lily"],
  [[224, 255, 255], "Light Cyan"],
  [[235, 244, 250], "Water"],
  [[240, 248, 255], "AliceBlue"],
  [[240, 255, 255], "Azure"],
  [[204, 255, 255], "Light Slate"],
  [[147, 255, 232], "Light Aquamarine"],
  [[154, 254, 255], "Electric Blue"],
  [[127, 255, 212], "Aquamarine"],
  [[0, 255, 255], "Cyan or Aqua"],
  [[125, 253, 254], "Tron Blue"],
  [[87, 254, 255], "Blue Zircon"],
  [[142, 235, 236], "Blue Lagoon"],
  [[80, 235, 236], "Celeste"],
  [[78, 226, 236], "Blue Diamond"],
  [[129, 216, 208], "Tiffany Blue"],
  [[146, 199, 199], "Cyan Opaque"],
  [[119, 191, 199], "Blue Hosta"],
  [[120, 199, 199], "Northern Lights Blue"],
  [[72, 204, 205], "Medium Turquoise"],
  [[67, 198, 219], "Turquoise"],
  [[70, 199, 199], "Jellyfish"],
  [[123, 204, 181], "Blue green"],
  [[67, 191, 199], "Macaw Blue Green"],
  [[62, 169, 159], "Light Sea Green"],
  [[59, 156, 156], "Dark Turquoise"],
  [[67, 141, 128], "Sea Turtle Green"],
  [[52, 135, 129], "Medium Aquamarine"],
  [[48, 125, 126], "Greenish Blue"],
  [[94, 125, 126], "Grayish Turquoise"],
  [[76, 120, 126], "Beetle Green"],
  [[0, 128, 128], "Teal"],
  [[78, 137, 117], "Sea Green"],
  [[120, 134, 107], "Camouflage Green"],
  [[132, 139, 121], "Sage Green"],
  [[97, 124, 88], "Hazel Green"],
  [[114, 140, 0], "Venom Green"],
  [[102, 124, 38], "Fern Green"],
  [[37, 65, 23], "Dark Forest Green"],
  [[48, 103, 84], "Medium Sea Green"],
  [[52, 114, 53], "Medium Forest Green"],
  [[67, 124, 23], "Seaweed Green"],
  [[56, 124, 68], "Pine Green"],
  [[52, 124, 44], "Jungle Green"],
  [[52, 124, 23], "Shamrock Green"],
  [[52, 128, 23], "Medium Spring Green"],
  [[78, 146, 88], "Forest Green"],
  [[106, 161, 33], "Green Onion"],
  [[74, 160, 44], "Spring Green"],
  [[65, 163, 23], "Lime Green"],
  [[62, 160, 85], "Clover Green"],
  [[108, 187, 60], "Green Snake"],
  [[108, 196, 23], "Alien Green"],
  [[76, 196, 23], "Green Apple"],
  [[82, 208, 23], "Yellow Green"],
  [[76, 197, 82], "Kelly Green"],
  [[84, 197, 113], "Zombie Green"],
  [[153, 198, 142], "Frog Green"],
  [[137, 195, 92], "Green Peas"],
  [[133, 187, 101], "Dollar Bill Green"],
  [[139, 179, 129], "Dark Sea Green"],
  [[156, 176, 113], "Iguana Green"],
  [[178, 194, 72], "Avocado Green"],
  [[157, 194, 9], "Pistachio Green"],
  [[161, 201, 53], "Salad Green"],
  [[127, 232, 23], "Hummingbird Green"],
  [[89, 232, 23], "Nebula Green"],
  [[87, 233, 100], "Stoplight Go Green"],
  [[100, 233, 134], "Algae Green"],
  [[94, 251, 110], "Jade Green"],
  [[0, 255, 0], "Green"],
  [[95, 251, 23], "Emerald Green"],
  [[135, 247, 23], "Lawn Green"],
  [[138, 251, 23], "Chartreuse"],
  [[106, 251, 146], "Dragon Green"],
  [[152, 255, 152], "Mint green"],
  [[181, 234, 170], "Green Thumb"],
  [[195, 253, 184], "Light Jade"],
  [[204, 251, 93], "Tea Green"],
  [[177, 251, 23], "Green Yellow"],
  [[188, 233, 84], "Slime Green"],
  [[237, 218, 116], "Goldenrod"],
  [[237, 226, 117], "Harvest Gold"],
  [[255, 232, 124], "Sun Yellow"],
  [[255, 255, 0], "Yellow"],
  [[255, 243, 128], "Corn Yellow"],
  [[255, 255, 194], "Parchment"],
  [[255, 255, 204], "Cream"],
  [[255, 248, 198], "Lemon Chiffon"],
  [[255, 248, 220], "Cornsilk"],
  [[245, 245, 220], "Beige"],
  [[251, 246, 217], "Blonde"],
  [[250, 235, 215], "AntiqueWhite"],
  [[247, 231, 206], "Champagne"],
  [[255, 235, 205], "BlanchedAlmond"],
  [[243, 229, 171], "Vanilla"],
  [[236, 229, 182], "Tan Brown"],
  [[255, 229, 180], "Peach"],
  [[255, 219, 88], "Mustard"],
  [[255, 216, 1], "Rubber Ducky Yellow"],
  [[253, 208, 23], "Bright Gold"],
  [[234, 193, 23], "Golden brown"],
  [[242, 187, 102], "Macaroni and Cheese"],
  [[251, 185, 23], "Saffron"],
  [[251, 177, 23], "Beer"],
  [[255, 166, 47], "Cantaloupe"],
  [[233, 171, 23], "Bee Yellow"],
  [[226, 167, 111], "Brown Sugar"],
  [[222, 184, 135], "BurlyWood"],
  [[255, 203, 164], "Deep Peach"],
  [[201, 190, 98], "Ginger Brown"],
  [[232, 163, 23], "School Bus Yellow"],
  [[238, 154, 77], "Sandy Brown"],
  [[200, 181, 96], "Fall Leaf Brown"],
  [[212, 160, 23], "Orange Gold"],
  [[194, 178, 128], "Sand"],
  [[199, 163, 23], "Cookie Brown"],
  [[198, 142, 23], "Caramel"],
  [[181, 166, 66], "Brass"],
  [[173, 169, 110], "Khaki"],
  [[193, 154, 107], "Camel brown"],
  [[205, 127, 50], "Bronze"],
  [[200, 129, 65], "Tiger Orange"],
  [[197, 137, 23], "Cinnamon"],
  [[175, 155, 96], "Bullet Shell"],
  [[175, 120, 23], "Dark Goldenrod"],
  [[184, 115, 51], "Copper"],
  [[150, 111, 51], "Wood"],
  [[128, 101, 23], "Oak Brown"],
  [[130, 120, 57], "Moccasin"],
  [[130, 123, 96], "Army Brown"],
  [[120, 109, 95], "Sandstone"],
  [[73, 61, 38], "Mocha"],
  [[72, 60, 50], "Taupe"],
  [[111, 78, 55], "Coffee"],
  [[131, 92, 59], "Brown Bear"],
  [[127, 82, 23], "Red Dirt"],
  [[127, 70, 44], "Sepia"],
  [[196, 116, 81], "Orange Salmon"],
  [[195, 98, 65], "Rust"],
  [[195, 88, 23], "Red Fox"],
  [[200, 90, 23], "Chocolate"],
  [[204, 102, 0], "Sedona"],
  [[229, 103, 23], "Papaya Orange"],
  [[230, 108, 44], "Halloween Orange"],
  [[248, 114, 23], "Pumpkin Orange"],
  [[248, 116, 49], "Construction Cone Orange"],
  [[230, 116, 81], "Sunrise Orange"],
  [[255, 128, 64], "Mango Orange"],
  [[248, 128, 23], "Dark Orange"],
  [[255, 127, 80], "Coral"],
  [[248, 129, 88], "Basket Ball Orange"],
  [[249, 150, 107], "Light Salmon"],
  [[231, 138, 97], "Tangerine"],
  [[225, 139, 107], "Dark Salmon"],
  [[231, 116, 113], "Light Coral"],
  [[247, 93, 89], "Bean Red"],
  [[229, 84, 81], "Valentine Red"],
  [[229, 91, 60], "Shocking Orange"],
  [[255, 0, 0], "Red"],
  [[255, 36, 0], "Scarlet"],
  [[246, 34, 23], "Ruby Red"],
  [[247, 13, 26], "Ferrari Red"],
  [[246, 40, 23], "Fire Engine Red"],
  [[228, 34, 23], "Lava Red"],
  [[228, 27, 23], "Love Red"],
  [[220, 56, 31], "Grapefruit"],
  [[195, 74, 44], "Chestnut Red"],
  [[194, 70, 65], "Cherry Red"],
  [[192, 64, 0], "Mahogany"],
  [[193, 27, 23], "Chilli Pepper"],
  [[159, 0, 15], "Cranberry"],
  [[153, 0, 18], "Red Wine"],
  [[140, 0, 26], "Burgundy"],
  [[149, 69, 53], "Chestnut"],
  [[126, 53, 23], "Blood Red"],
  [[138, 65, 23], "Sienna"],
  [[126, 56, 23], "Sangria"],
  [[128, 5, 23], "Firebrick"],
  [[129, 5, 65], "Maroon"],
  [[125, 5, 65], "Plum Pie"],
  [[126, 53, 77], "Velvet Maroon"],
  [[125, 5, 82], "Plum Velvet"],
  [[127, 78, 82], "Rosy Finch"],
  [[127, 90, 88], "Puce"],
  [[127, 82, 93], "Dull Purple"],
  [[179, 132, 129], "Rosy Brown"],
  [[197, 144, 142], "Khaki Rose"],
  [[196, 129, 137], "Pink Bow"],
  [[196, 135, 147], "Lipstick Pink"],
  [[232, 173, 170], "Rose"],
  [[236, 197, 192], "Rose Gold"],
  [[237, 201, 175], "Desert Sand"],
  [[253, 215, 228], "Pig Pink"],
  [[252, 223, 255], "Cotton Candy"],
  [[255, 223, 221], "Pink Bubble Gum"],
  [[251, 187, 185], "Misty Rose"],
  [[250, 175, 190], "Pink"],
  [[250, 175, 186], "Light Pink"],
  [[249, 167, 176], "Flamingo Pink"],
  [[231, 161, 176], "Pink Rose"],
  [[231, 153, 163], "Pink Daisy"],
  [[227, 138, 174], "Cadillac Pink"],
  [[247, 120, 161], "Carnation Pink"],
  [[229, 110, 148], "Blush Red"],
  [[246, 96, 171], "Hot Pink"],
  [[252, 108, 133], "Watermelon Pink"],
  [[246, 53, 138], "Violet Red"],
  [[245, 40, 135], "Deep Pink"],
  [[228, 94, 157], "Pink Cupcake"],
  [[228, 40, 124], "Pink Lemonade"],
  [[245, 53, 170], "Neon Pink"],
  [[255, 0, 255], "Magenta"],
  [[227, 49, 157], "Dimorphotheca Magenta"],
  [[244, 51, 255], "Bright Neon Pink"],
  [[209, 101, 135], "Pale Violet Red"],
  [[194, 90, 124], "Tulip Pink"],
  [[202, 34, 107], "Medium Violet Red"],
  [[193, 40, 105], "Rogue Pink"],
  [[193, 34, 103], "Burnt Pink"],
  [[194, 82, 131], "Bashful Pink"],
  [[193, 34, 131], "Dark Carnation Pink"],
  [[185, 59, 143], "Plum"],
  [[126, 88, 126], "Viola Purple"],
  [[87, 27, 126], "Purple Iris"],
  [[88, 55, 89], "Plum Purple"],
  [[75, 0, 130], "Indigo"],
  [[70, 27, 126], "Purple Monster"],
  [[78, 56, 126], "Purple Haze"],
  [[97, 64, 81], "Eggplant"],
  [[94, 90, 128], "Grape"],
  [[106, 40, 126], "Purple Jam"],
  [[125, 27, 126], "Dark Orchid"],
  [[167, 74, 199], "Purple Flower"],
  [[176, 72, 181], "Medium Orchid"],
  [[108, 45, 199], "Purple Amethyst"],
  [[132, 45, 206], "Dark Violet"],
  [[141, 56, 201], "Violet"],
  [[122, 93, 199], "Purple Sage Bush"],
  [[127, 56, 236], "Lovely Purple"],
  [[142, 53, 239], "Purple"],
  [[137, 59, 255], "Aztech Purple"],
  [[132, 103, 215], "Medium Purple"],
  [[162, 59, 236], "Jasmine Purple"],
  [[176, 65, 255], "Purple Daffodil"],
  [[196, 90, 236], "Tyrian Purple"],
  [[145, 114, 236], "Crocus Purple"],
  [[158, 123, 255], "Purple Mimosa"],
  [[212, 98, 255], "Heliotrope Purple"],
  [[226, 56, 236], "Crimson"],
  [[195, 142, 199], "Purple Dragon"],
  [[200, 162, 200], "Lilac"],
  [[230, 169, 236], "Blush Pink"],
  [[224, 176, 255], "Mauve"],
  [[198, 174, 199], "Wisteria Purple"],
  [[249, 183, 255], "Blossom Pink"],
  [[210, 185, 211], "Thistle"],
  [[233, 207, 236], "Periwinkle"],
  [[235, 221, 226], "Lavender Pinocchio"],
  [[227, 228, 250], "Lavender blue"],
  [[253, 238, 244], "Pearl"],
  [[255, 245, 238], "SeaShell"],
  [[254, 252, 255], "Milk White"],
  [[255, 255, 255], "White"]
];

export default {
  extends: Line,
  name: "TotalExpensesGraphComponent",
  mounted() {
    this.getData(this.showTables);
  },
  methods: {
    getData(callback) {
      fetch("/api/graph")
        .then(r => r.json())
        .then(callback);
    },

    showTables(data) {
      const categories = {};
      const currentColors = [...colors];
      let val = 0;
      console.log(data);
      for (const d of data) {
        let obj = categories[d.categoryid];
        if (!obj)
          obj = categories[d.categoryid] = {
            name: d.cname,
            amounts: [],
            colors: []
          };

        const i = Math.round(Math.random() * (currentColors.length - 1));
        const color = currentColors[i][0];
        currentColors.splice(i, 1);

        val += d.amount;

        obj.amounts.push({ y: val, t: new Date(d.createdat) });
        obj.colors.push(`rgba(${color[0]}, ${color[1]}, ${color[2]}, 1)`);
      }

      const arr = Object.values(categories);
      this.renderChart(
        {
          datasets: arr.map(x => ({
              label: x.name,
              data: [...x.amounts].sort((a, b) => a.t > b.t ? 1 : -1),
              borderColor: x.colors,
              lineTension: 0.1,  
              backgroundColor: "transparent"
            })).sort((a, b) => (a.label > b.label ? 1 : -1))
        },
        {
          responsive: true,
          maintainAspectRatio: false,
          bezierCurve: false,
          scales: {
            xAxes: [
              {
                type: "time",
                time: {
                  unit: "day"
                }
              }
            ]
          }
        }
      );
    }
  }
};
</script>

<style lang="scss" scoped></style>
